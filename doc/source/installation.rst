============
Installation
============

Installing prerequisites:

.. code-block:: bash

    $ sudo yum install git createrepo python-virtualenv git-hg mock

Add the user you intend to run as to the mock group:

.. code-block:: bash

    $ sudo usermod -a -G mock $USER
    $ newgrp mock
    $ newgrp $USER

If you want to serv the built packages and the status reports:

.. code-block:: bash

    $ systemctl start httpd

Install Delorean:

.. code-block:: bash

    $ pip install delorean

Or, if you have virtualenvwrapper installed:

.. code-block:: bash

    $ mkvirtualenv delorean
    $ pip install delorean

The httpd module is not strictly required, Delorean does not use it. However, it will output
it's results in a way that is suitable for a web-server to serve. This means you can easily set up
a web-server to serve the finished ``.rpm`` and ``.log`` files.


Configuration
-------------

Configuration is done in an INI-file. An example file called ``projects.ini`` is included.
The configuration file looks like this:

.. code-block:: ini

    [DEFAULT]
    datadir=./data
    baseurl=https://trunk.rdoproject.org/
    distro=rpm-master
    smtpserver=
    maxretries=3
    target=centos

* ``datadir`` is the directory where the packages and repositories will be created.

* ``baseurl`` is the URL to the data-directory, as hosted by your web-server. Unless you are
  installing Delorean for local use only, this must be a publicly accessible URL.

* ``distro`` is the branch to use for building the packages.

* ``target`` is the distribution to use for building the packages (``centos`` or ``fedora``).

* ``smtpserver`` is the address of the mail server for sending out notification emails.
  If this is empty no emails will be sent out. If you are running Delorean locally,
  then do not set an smtpserver.

* ``maxretries`` is the maximum number of retries on known errors before marking the build
  as failed. If a build fails, Delorean will check the log files for known, transient errors
  such as network issues. If the build fails for that reason more than maxretries times, it
  will be marked as failed.

Configuring your httpd
----------------------

The output generated by Delorean is a file structure suitable for serving with a web-server.
You can either add a section in the server configuration where you map a URL to the
data directories, or just make a symbolic link:

.. code-block:: bash

    $ cd /var/www/html
    $ sudo ln -s <datadir>/repos .

